/* ─────────────────────────────────────────────────────────────
   Garden UI — Field skin (opt‑in)
   Whisper: "clarity first; comfort follows." 🌬️

   Purpose
     • Selector-only skin for the headless Field primitive.
     • Driven by Garden tokens; no hardcoded hex.

   Data API
     • [data-ui='field']                          — root
     • [data-part='label|hint|description|error|control|optional']
     • [data-state='error|disabled']              — this skin handles these; 'invalid' may map to 'error' upstream
     • [data-required] on label — calm bullet (•) suffix
     • [data-disabled] on root when control is disabled (preferred over data-state)

   Notes
     • Focus ring uses --ring-accent (falls back to accent mix).
     • Control shell holds visuals; native input/textarea/select are reset inside it.
     • Keep motion subtle; avoid intrusive animations in forms.
     • Back-compat: this skin also honors [data-state='disabled'] and [data-state='error'] in addition to 'invalid'.
   ──────────────────────────────────────────────────────────── */
@layer components {
  [data-ui='field'] {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    color: var(--text);
  }

  /* parts */
  [data-ui='field'] [data-part='label'] {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text);
  }
  [data-ui='field'] [data-part='label'] {
    display: inline-flex;
    align-items: baseline;
    gap: 0.25rem;
  }
  [data-ui='field'] [data-part='optional'] {
    margin-left: 0.375rem;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-faint);
  }
  [data-ui='field'] [data-part='hint'] {
    font-size: 0.75rem;
    color: var(--text-faint);
  }
  [data-ui='field'] [data-part='description'] {
    font-size: 0.875rem;
    color: var(--text-subtle);
  }
  [data-ui='field'] [data-part='error'] {
    font-size: 0.875rem;
    color: var(--color-danger);
  }

  /* input shell (when you wrap a native input inside) */
  [data-ui='field'] [data-part='control'] {
    /* control shell (keeps visuals on container; native element stays clean) */
    display: block;
    width: 100%;
    border: 1px solid var(--color-border);
    background: var(--color-surface);
    color: var(--text);
    border-radius: var(--radius-md, 0.375rem);
    padding: 0.5rem 0.75rem;
    transition: border-color 0.15s ease, background-color 0.15s ease, box-shadow 0.15s ease, outline-color 0.15s ease;
    position: relative;
    --_ring-size: var(--ring-size, 1px);
    --_ring-color: var(--ring-accent, color-mix(in oklab, var(--color-accent) 85%, white 15%));
  }
  [data-ui='field'] [data-part='control']:hover {
    border-color: color-mix(in oklab, var(--color-accent) 28%, var(--color-border));
  }
  [data-ui='field'] [data-part='control']:focus-within {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 var(--_ring-size) var(--_ring-color), 0 2px 14px color-mix(in oklab, var(--color-accent) 10%, transparent);
  }

  /* Native control resets inside the shell */
  [data-ui='field']
    [data-part='control']
    :is(
      input[type='text'],
      input[type='email'],
      input[type='search'],
      input[type='password'],
      input[type='tel'],
      input[type='url'],
      input[type='number'],
      textarea,
      select
    ) {
    background: transparent;
    border: 0;
    outline: none;
    margin: 0;
    padding: 0;
    width: 100%;
    min-width: 0; /* allow shrinking in flex/overflow layouts */
    font: inherit;
    line-height: 1.4;
    color: var(--text);
    caret-color: var(--color-accent);
  }

  /* Placeholder & selection */
  [data-ui='field'] [data-part='control'] :is(input, textarea)::placeholder {
    color: var(--text-faint);
    opacity: 1;
  }
  [data-ui='field'] [data-part='control'] *::selection {
    background: color-mix(in oklab, var(--color-accent) 22%, transparent);
  }

  /* Textarea sizing */
  [data-ui='field'] [data-part='control'] textarea {
    resize: vertical;
    min-height: 2.5rem;
  }

  /* Select tweaks */
  [data-ui='field'] [data-part='control'] select {
    appearance: none;
    padding-right: 1.5rem; /* room for chevron */
    background-image: linear-gradient(45deg, transparent 50%, currentColor 50%), linear-gradient(135deg, currentColor 50%, transparent 50%);
    background-position: right 0.5rem center, right 0.25rem center;
    background-size: 6px 6px, 6px 6px;
    background-repeat: no-repeat;
    color: var(--text);
  }

  /* Disabled/read-only native controls (mirrors root [data-disabled]) */
  [data-ui='field'] [data-part='control'] :is(input, textarea, select):disabled,
  [data-ui='field'][data-disabled] [data-part='control'] :is(input, textarea, select) {
    cursor: not-allowed;
    opacity: 0.7;
  }
  [data-ui='field'] [data-part='control'] :is(input, textarea, select)[readonly] {
    opacity: 0.85;
  }

  /* states */
  [data-ui='field'][data-state='invalid'] [data-part='control'] {
    border-color: var(--color-danger);
    box-shadow: 0 0 0 var(--_ring-size) color-mix(in oklab, var(--color-danger) 60%, transparent);
  }
  /* alias: some callers emit 'error' instead of 'invalid' */
  [data-ui='field'][data-state='error'] [data-part='control'] {
    border-color: var(--color-danger);
    box-shadow: 0 0 0 var(--_ring-size) color-mix(in oklab, var(--color-danger) 60%, transparent);
  }

  /* Disabled — prefer [data-disabled] on root; keep data-state='disabled' for back-compat */
  [data-ui='field'][data-disabled] [data-part='label'] {
    color: var(--text-subtle);
  }
  [data-ui='field'][data-disabled] [data-part='hint'],
  [data-ui='field'][data-disabled] [data-part='description'] {
    color: var(--text-faint);
  }
  [data-ui='field'][data-disabled] [data-part='control'] {
    cursor: not-allowed;
    opacity: 0.6;
    background: color-mix(in oklab, var(--surface) 92%, var(--elev) 8%);
    box-shadow: none;
    outline: none;
  }
  /* Back-compat: support the old state hook */
  [data-ui='field'][data-state='disabled'] [data-part='label'] {
    color: var(--text-subtle);
  }
  [data-ui='field'][data-state='disabled'] [data-part='hint'],
  [data-ui='field'][data-state='disabled'] [data-part='description'] {
    color: var(--text-faint);
  }
  [data-ui='field'][data-state='disabled'] [data-part='control'] {
    cursor: not-allowed;
    opacity: 0.6;
    background: color-mix(in oklab, var(--surface) 92%, var(--elev) 8%);
    box-shadow: none;
    outline: none;
  }

  /* calm required marker (dot) */
  [data-ui='field'] [data-part='label'][data-required]::after {
    content: '•';
    margin-left: 0.25rem;
    opacity: 0.55;
  }
}
